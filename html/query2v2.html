<!DOCTYPE html>
<html>
<head>
  <title>Image Tag Search and Delete</title>
</head>
<body>
  <h2>Find Images by Tags</h2>
  <form id="search-form" onsubmit="searchImages(event)">
    <div id="input-container">
      <div class="input-pair">
        <label for="tag-1">Tag:</label>
        <input type="text" class="tag-input" name="tag-1" placeholder="Enter a tag" required>
        <label for="count-1">Count:</label>
        <input type="number" class="count-input" name="count-1" min="1" required>
      </div>
    </div>

    <button type="button" onclick="addInputFields()">+</button>
    <button type="button" onclick="removeInputFields()">-</button>

    <div>
      <button type="submit">Search</button>
    </div>
  </form>

  <h2>Delete Image</h2>
  <input type="text" id="delete-url-input" placeholder="Enter image URL">
  <button onclick="deleteImage()">Delete</button>

  <script>
    function addInputFields() {
      var inputContainer = document.getElementById('input-container');
      var inputIndex = inputContainer.childElementCount + 1;

      var inputDiv = document.createElement('div');
      inputDiv.classList.add('input-pair');
      inputDiv.innerHTML = `
        <label for="tag-${inputIndex}">Tag:</label>
        <input type="text" class="tag-input" name="tag-${inputIndex}" placeholder="Enter a tag" required>
        <label for="count-${inputIndex}">Count:</label>
        <input type="number" class="count-input" name="count-${inputIndex}" min="1" required>
      `;

      inputContainer.appendChild(inputDiv);
    }

    function removeInputFields() {
      var inputContainer = document.getElementById('input-container');
      var inputDivs = inputContainer.getElementsByClassName('input-pair');
      var inputCount = inputDivs.length;

      if (inputCount > 1) {
        inputContainer.removeChild(inputDivs[inputCount - 1]);
      }
    }

    function searchImages(event) {
      event.preventDefault();

      var inputs = document.getElementsByClassName('tag-input');
      var tags = [];

      for (var i = 0; i < inputs.length; i++) {
        tags.push(inputs[i].value.trim());
      }

      inputs = document.getElementsByClassName('count-input');
      var counts = [];

      for (var i = 0; i < inputs.length; i++) {
        var count = parseInt(inputs[i].value);
        counts.push(count);
      }

      var searchURL = 'https://r5lphjguqg.execute-api.us-east-1.amazonaws.com/app-prod/tags?';

      for (var i = 0; i < tags.length; i++) {
        var tagParam = 'tag' + (i + 1);
        var countParam = 'tag' + (i + 1) + 'count';
        searchURL += tagParam + '=' + encodeURIComponent(tags[i]) + '&';
        searchURL += countParam + '=' + counts[i] + '&';
      }

      searchURL = searchURL.slice(0, -1);
      window.location.href = searchURL;
    }

    function deleteImage() {
      var deleteUrlInput = document.getElementById('delete-url-input');
      var deleteUrl = deleteUrlInput.value.trim();
    
      fetch(deleteUrl, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          url: 's3://imagefile-storage/' + deleteUrl.substring(deleteUrl.lastIndexOf('/') + 1)
        })
      })
      .then(function(response) {
        if (response.ok) {
          console.log("Delete request successful!");
          // Handle the response here if needed
        } else {
          console.log("Delete request failed!");
          // Handle any errors here if needed
        }
      })
      .catch(function(error) {
        console.log("Delete request failed!");
        // Handle any errors here if needed
      })
      .finally(function() {
        deleteUrlInput.value = ''; // Clear the input value
      });
    }
  </script>
</body>
</html>
